@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

@{
    ViewData["Title"] = "Pay with PayPal";
}

<h2>@ViewData["Title"]</h2>

<!-- Input field for donation amount -->
<form id="donation-form">
    <label for="amount">Enter amount to donate:</label>
    <input type="number" id="amount" name="amount" step="0.01" min="0" required />
    <button type="button" id="pay-button">Pay with PayPal</button>
</form>

<!-- Container for PayPal button -->
<div id="paypal-button-container"></div>

<script src="https://www.paypal.com/sdk/js?client-id=@Configuration["PayPal:ClientId"]"></script>
<script>
    document.getElementById('pay-button').addEventListener('click', function () {
        var amount = document.getElementById('amount').value;
        if (amount <= 0) {
            alert('Please enter a valid amount.');
            return;
        }

        // Render the PayPal button with the user-specified amount
        paypal.Buttons({
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: amount // Use the user input amount
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    alert('Transaction completed by ' + details.payer.name.given_name);
                    // Optionally, redirect to a success page or update the UI here
                });
            },
            onCancel: function (data) {
                alert('Transaction was cancelled');
            },
            onError: function (err) {
                console.error(err);
                alert('An error occurred during the transaction');
            }
        }).render('#paypal-button-container'); // Renders the PayPal button into the container
    });
</script>
